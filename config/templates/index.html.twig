{% extends 'base.html.twig' %}

{% block body %}
    <div class="flex flex-col flex-wrap items-stretch justify-between p-6 bg-blue-100 rounded-b shadow md:flex-row md:flex-nowrap md:items-center dark:bg-gray-600">
        <div class="flex justify-start order-first mb-3 md:order-none md:mb-0">
            <div class="relative" data-controller="dropdown">
                <div data-action="click->dropdown#toggle click@window->dropdown#hide"
                    role="button"
                    data-dropdown-target="button"
                    tabindex="0"
                    class="flex flex-row mr-6">
                    <div class="flex items-center text-yellow-400 align-middle rounded-full fill-current">
                        {% include './svg/noun_fav star_2154219.svg' %}
                    </div>
                    <div class="flex items-center text-gray-700 align-middle">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 20 20"
                            class="w-4 h-4">
                            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"></path>
                        </svg>
                    </div>
                </div>
                <div data-dropdown-target="menu"
                    class="absolute right-0 z-10 hidden mt-2">
                    <div class="overflow-hidden bg-white border rounded shadow"
                        {{ stimulus_controller('fav') }}
                        data-fav-target="list">
                        <a href="#"
                            class="block px-8 py-3 text-gray-900 no-underline bg-white border-t dark:text-gray-100 dark:hover:bg-gray-600 hover:bg-gray-300 dark:bg-gray-700 whitespace-nowrap">
                            It seems that you havn't any favorites yet
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex flex-grow" {{ stimulus_controller('token-choices') }}>
            <div class="w-full bg-gray-50 h-11"
                data-token-choices-target="holder"></div>
            <form data-token-choices-target="form"
                class="hidden w-full dark:text-gray-600">
                <div>
                    <select class="form-control"
                        id="token-choices"
                        onchange="window.location.replace('?address=' + this.value)"
                        class="w-full">
                        {% for t in tokens %}
                            {% set selected = t.address == token.address
                                ? 'selected'
                                : ''
                            %}
                            <option value="{{ t.address }}"
                                {{ selected }}
                                class="w-full">
                                {{ t.metadata.symbol }} {% if
                                    t.metadata.name is defined %}
                                    ({{ t.metadata.name }})
                                {% endif %}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </form>
        </div>

        <div class="flex justify-end order-first mb-3 md:order-none md:mb-0">
            <div class="relative" data-controller="dropdown">
                <div data-action="click->dropdown#toggle click@window->dropdown#hide"
                    role="button"
                    data-dropdown-target="button"
                    tabindex="0"
                    class="flex flex-row ml-6">
                    {% if is_granted('ROLE_MEMBER') %}
                        <div class="flex items-center align-middle rounded-full">
                            {{ app.user.address }}
                        </div>
                    {% else %}
                        <div class="flex items-center text-blue-300 align-middle rounded-full fill-current">
                            {% include './svg/noun_anonymous_638448.svg' %}
                        </div>
                    {% endif %}
                    <div class="flex items-center text-gray-700 align-middle">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 20 20"
                            class="w-4 h-4">
                            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"></path>
                        </svg>
                    </div>
                </div>
                <div data-dropdown-target="menu"
                    class="absolute right-0 z-10 hidden mt-2">
                    <div class="overflow-hidden bg-white border rounded shadow">
                        {% if is_granted('ROLE_MEMBER') %}
                            <a href="{{ path('app_logout') }}"
                                class="block px-8 py-3 text-gray-900 no-underline bg-white border-t dark:text-gray-100 dark:hover:bg-gray-600 hover:bg-gray-300 dark:bg-gray-700 whitespace-nowrap">
                                Disconnect
                            </a>
                            <a href="{{ path('app_token_list') }}"
                                class="block px-8 py-3 text-gray-900 no-underline bg-white border-t dark:hover:bg-gray-600 hover:bg-gray-300 whitespace-nowrap dark:bg-gray-700">
                                Admin
                            </a>
                        {% else %}
                            <div {{ stimulus_controller('wallet') }}>
                                <a href="#"
                                    data-action="wallet#login"
                                    class="z-50 block px-8 py-3 text-gray-900 no-underline bg-white border-t hover:bg-gray-300 whitespace-nowrap">
                                    Connect Wallet
                                </a>
                                {{ form(loginForm) }}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard">
        <div class="divide-x divide-gray-200 | token">
            <div>
                {% if token.metadata.thumbnail_uri ?? null %}
                    <img src="{{ token.metadata.thumbnail_uri }}"
                        class="w-32" />
                {% else %}
                    {% include './svg/noun_explosion_563988.svg' %}
                {% endif %}
                <div class="flex flex-row mt-6 justify-evenly">
                    <a href="https://quipuswap.com/swap?from=tez&to={{
                        token.address
                        }}"
                        target="new"
                        class="btn-small btn-buy">
                        BUY
                    </a>
                    <a href="https://quipuswap.com/swap?from={{
                        token.address
                        }}&to=tez"
                        target="new"
                        class="btn-small btn-sell">
                        SELL
                    </a>
                </div>
            </div>
            <div class="flex-grow pl-6 mx-6">
                <div class="flex flex-row items-center justify-around w-full">
                    {% if token.metadata.name ?? null %}
                        <span class="flex-grow | name">
                            {{ token.metadata.name }}
                        </span><br />
                    {% endif %}
                    {% if token.metadata.homepage is defined %}
                        <a href="{{ token.metadata.homepage }}">
                            {{ token.metadata.homepage }}
                        </a>
                    {% endif %}

                    {% if token.metadata.twitter is defined %}
                        <a href="{{ token.metadata.twitter }}" class="ml-3">
                            {% include './svg/Twitter_Bird.svg' %}
                        </a>
                    {% endif %}

                    {% if token.metadata.telegram is defined %}
                        <a href="{{ token.metadata.telegram }}" class="ml-3">
                            {% include './svg/Telegram_2019_Logo.svg' %}
                        </a>
                    {% endif %}

                    {% if token.metadata.discord is defined %}
                        <a href="{{ token.metadata.discord }}" class="ml-3">
                            {% include './svg/Discord_logo.svg' %}
                        </a>
                    {% endif %}

                    {% if token.metadata.reddit is defined %}
                        <a href="{{ token.metadata.reddit }}" class="ml-3">
                            {% include './svg/Reddit_logo.svg' %}
                        </a>
                    {% endif %}

                    {% if token.metadata.facebook is defined %}
                        <a href="{{ token.metadata.facebook }}" class="ml-3">
                            {% include './svg/Facebook_logo.svg' %}
                        </a>
                    {% endif %}

                    {% if token.metadata.instagram is defined %}
                        <a href="{{ token.metadata.instagram }}" class="ml-3">
                            {% include './svg/Instagram_logo_2016.svg' %}
                        </a>
                    {% endif %}

                    {% if token.metadata.github is defined %}
                        <a href="{{ token.metadata.github }}" class="ml-3">
                            {% include './svg/Octicons-mark-github.svg' %}
                        </a>
                    {% endif %}

                    <a class="ml-3 fill-current fav-button text-gray-50 hover:text-yellow-400"
                        href="#"
                        title="Click to add to favorites"
                        {{
                        stimulus_controller(
                            'fav-button',
                            {
                                url: path('app_homepage') ~ '?address='
                                    ~ token.address,
                                name: token.metadata.symbol
                            }
                        )
                        }}
                        data-action="click->fav-button#toggle"
                        data-fav-button-target="button">
                        {% include './svg/noun_fav star_2154219.svg' %}
                    </a>
                </div>

                {% if token.metadata.description is defined %}
                    <div class="my-3 | description">
                        {{ token.metadata.description }}
                    </div>
                {% endif %}
                <div class="flex justify-between">
                    <div>
                        <ul>
                            <li>Supply: {{ supply|number_format }}</li>
                            <li>
                                Standard: {{ token.address.id is not null ? 'FA2' : 'FA1.2' }}
                            </li>
                            <li>Decimals: {{ token.metadata.decimals }}</li>
                            <li>
                                Contract: <a href="https://better-call.dev/mainnet/{{
                                    token.address.contract
                                    }}/tokens"
                                    class="underline">
                                    bcd
                                </a> | <a href="https://tzkt.io/{{ token.address.contract }}/dex" target="new" class="underline">tzkt</a>
                            </li>
                            {% for exchange in token.exchanges %}
                                <li>
                                    {{ exchange.exchangeName }}: <a href="https://better-call.dev/mainnet/{{
                                        exchange.contract
                                        }}"
                                        class="underline">
                                        bcd
                                    </a> | <a href="https://tzkt.io/{{
                                        exchange.contract
                                        }}/dex"
                                        target="new"
                                        class="underline">
                                        tzkt
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="pt-4">
                        {% for tag in token.tags %}
                            <span class="inline-flex items-center justify-center px-2 py-1 mr-2 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full">
                                {{ tag.label }}
                            </span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if charts is not empty %}
        <div>
            <div>
                <div class="mt-2"
                    {{
                    stimulus_controller(
                        'refresh-content',
                        {
                            url: path(
                                '_app_token_last_update',
                                {
                                    address: token.address
                                }
                            ),
                            interval: refresh_interval_ms,
                            useEffect: true
                        }
                    )
                    }}
                    data-refresh-content-target="content"
                    data-action="chartjs:updated->reload-content#refreshContent">
                    {% include './_token_last_update.html.twig' %}
                </div>
            </div>

            <div {{ stimulus_controller('time_interval_form') }}
                class="custom-radio-buttons">
                {% form_theme timeIntervalForm
                    with['form_div_layout.html.twig']
                    only
                %}
                {{ form(timeIntervalForm) }}
            </div>

            <div {{ stimulus_controller('tabs') }}
                data-tabs-active-tab="z-10 -mb-px bg-gray-50 dark:bg-gray-700"
                class="tabs">
                <ul class="flex items-end border-b">
                    {% for title in charts.QuipuSwap|keys %}
                        <li data-tabs-target="tab"
                            data-action="click->tabs#change"
                            class="mr-1">
                            <a class="inline-block px-4 py-2 font-semibold text-blue-800 no-underline bg-white border-t border-l border-r rounded-t cursor-pointer hover:text-blue-800 dark:hover:text-blue-300">
                                {{ title }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
                {% for title, chart in charts.QuipuSwap %}
                    <div data-tabs-target="panel"
                        class="chart dark:bg-gray-700 dark:text-gray-100">
                        {% if loop.first %}
                            <span class="spinner">
                                {% include './svg/noun_spinner_639850.svg' %}
                            </span>
                        {% endif %}

                        {{
                            render_chart(
                                chart,
                                {
                                    'data-controller': 'chartjs',
                                    'data-action': 'chartjs:connect->chartjs#onChartConnect',
                                    'data-chartjs-title-value': title,
                                    'data-chartjs-interval-value': refresh_interval_ms,
                                    'data-chartjs-diff-url-value': path(
                                        '_app_token_diff',
                                        {
                                            address: token.address
                                        }
                                    )
                                }
                            )
                        }}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
{% endblock %}
